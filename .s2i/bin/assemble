#!/bin/bash

set -e
set -x

CWD="samples/MusicStore.Standalone"

function fix-perms() # $1->path
{
    chgrp -R 0 $1
    chmod -R og+rw $1
    find $1 -type d -exec chmod g+x {} +
}

echo "---> Copying musicstore source ..."
cp -Rf /tmp/src/. ./

echo "---> Installing musicstore dependencies ..."
[ -n "$CWD" ] && [ -d "$CWD" ] && (cd $CWD && dotnet restore)

echo "---> Building musicstore from source ..."
[ -n "$CWD" ] && [ -d "$CWD" ] && (cd $CWD && dotnet build)

fix-perms ./
fix-perms /opt/app-root
